<app-loader [size]=60 [color]="'white'" *ngIf="saveLoad" class="loader-popup"></app-loader>
<div class="page" (click)="hideCalendar($event)">
  <app-breadcrumb *ngIf="!loadSave"  [data]="contentHeader"></app-breadcrumb>
  <!-- 
  <div class="header float-left w-100 mb-2 d-flex">
    <div class="col-md-6 pl-0">
      <h2 class="float-left pr-2 w-100"><strong>{{pageTitle}}</strong></h2>
      <div class="breadcrumb-wrapper w-100">
        <ol class="breadcrumb">
          <li> <a routerLink="/dashboard">Dashboard</a> </li>
          <li><a class="smview" routerLink="/solgenreport/customreports">Dynamic Reports</a></li>
          <li class="active">{{pageTitle}}</li>
        </ol>
      </div>
    </div>
    <div class="col-md-6 text-right right pr-0">
      <a href="javascript:;" class="btn btn-primary" data-toggle="modal" data-target="#headerswtichuser"><i class="fa fa-sign-in mr-1"></i>Switch Company</a>
    </div>
  </div> -->
  <div class="clearfix"></div>

  <div class="row">
    <div class="col-lg-12 portlets">
      <div class="panel">
        <div class="panel-header border-bottom pb-3 btn-iconres">
          <div class="row mt-2">
            <div class="col-md-12">
              <div class="row">

                <div class="col-12 col-md-6 col-lg-3">
                  <label>Report Name:<span class="text-danger">*</span></label>
                  <div class="form-group">
                    <input type="text" class="form-control" [(ngModel)]="reportName" (keyup)="onKeyReport($event)" placeholder="Enter Report Name" />
                    <small *ngIf="isReportNameValid"
                           style="color:red;">Report Name is required.</small>
                  </div>
                </div>

                <div class="col-12 col-md-6 col-lg-2">
                  <label>Sub Module Name:<span class="text-danger">*</span></label>
                  <div class="form-group">
                    <ng-select [items]="submodulelist" placeholder="Select Sub Module" bindValue="value" bindLabel="text"
                               [(ngModel)]="subModuleSelectedValue"
                               (change)="onSelectSubModule($event)" (clear)="resetSubModule()">
                    </ng-select>
                    <small *ngIf="isSubModuleSelected"
                           style="color:red;">Sub Module is required.</small>
                  </div>
                </div>

                <!--<div class="col-12 col-md-6 col-lg-3">
                  <label>Sub Module Fields:<span class="text-danger">*</span></label>
                  <div class="form-group">
                    <ng-select [items]="subModuleFieldList" placeholder="Sub Module Fields" bindValue="value" bindLabel="text"
                               [(ngModel)]="subModuleFieldsSelectedValue" [multiple]="true"
                               (clear)="resetSubModuleFieldIds()">
                    </ng-select>
                  </div>
                </div>-->
                <div class="col-12 col-md-6 col-lg-3">
                  <div *ngIf="showDateFilterTop">
                    <label>Date Range:</label>
                    <div class="input-group" style="width: auto !important;">
                      <input type="text"
                             [ngClass]="{'is-invalid':  isDateFilterValid}"
                             class="form-control" placeholder="Select Date" (click)="ShowCustomDateFilter()" [(ngModel)]="selectedFilter" aria-label="Recipient's username" aria-describedby="basic-addon2" />

                      <div class="input-group-append">
                        <span class="input-group-text closeCustomFilter" id="basic-addon2" (click)="ShowCustomDateFilter()"><i class="feather-calendar m-0"></i></span>
                      </div>

                      <div class="dasboard-calc" *ngIf="showDateFilter" style="position:initial;">
                        <span><a href="javascript:void(0);" (click)="today()" [ngClass]="{'cal-active' : selectedFilter==='Today'}">Today</a> </span>
                        <span> <a href="javascript:void(0);" (click)="yesterday()" [ngClass]="{'cal-active' : selectedFilter==='Yesterday'}">Yesterday</a></span>

                        <span> <a href="javascript:void(0);" (click)="ThisWeek()" [ngClass]="{'cal-active' : selectedFilter==='This Week'}">This Week</a></span>

                        <span> <a href="javascript:void(0);" (click)="LastWeek()" [ngClass]="{'cal-active' : selectedFilter==='Last Week'}">Last Week</a></span>
                        <span> <a href="javascript:void(0);" (click)="thisMopnth()" [ngClass]="{'cal-active' : selectedFilter==='This Month'}">This Month</a></span>
                        <span> <a href="javascript:void(0);" (click)="lastMonth()" [ngClass]="{'cal-active' : selectedFilter==='Last Month'}">Last Month</a>   </span>
                        <span>  <a href="javascript:void(0);" (click)="thisYear()" [ngClass]="{'cal-active' : selectedFilter==='This Year'}">This Year </a> </span>
                        <span>   <a href="javascript:void(0);" (click)="lastYear()" [ngClass]="{'cal-active' : selectedFilter==='Last Year'}">Last Year </a> </span>
                        <span class="w-100 border-0 text-center"><a href="javascript:void(0);">Custom Range</a></span>

                        <div class="date-box p-2">
                          <p-calendar appendTo = "body" #myStartCalendar placeholder="From Date - To Date" [(ngModel)]="rangeDates" selectionMode="range" [readonlyInput]="true" inputId="range" (onSelect)="OnChangedDateRange($event)" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2030"
                                      (click)="customRange()" [ngClass]="{'cal-active' : selectedFilter==='Custom Range'}"></p-calendar>
                          <span id="basic-addon2"><i class="feather-calendar"></i></span>
                        </div>
                      </div>

                    </div>
                    <small *ngIf="isDateFilterValid"
                           style="color:red;">Please select Date Filter</small>
                  </div>
                </div>


                <div class="col-12 col-md-6 col-lg-4 mt-4" style="text-align: end;">
                  <button *ngIf="!showFilter" class="btn btn-dark mr-2" (click)="showFilterButton()" href="javascript:void(0)"><i class="feather-eye mr-1"></i>Show Filter</button>
                  <button *ngIf="hideFilter" class="btn btn-dark mr-2" (click)="hideFilterButton()" href="javascript:void(0)"><i class="feather-eye-off mr-1"></i>Hide Filter</button>
                  <div class="d-inline-block">
                    <button class="btn btn-primary mr-2" (click)="SaveAllFields()" href="javascript:void(0)"><i class="feather-save mr-1"></i>Save</button>
                  </div>
                  <div class="d-inline-block" *ngIf='showEditBtns'>
                    <a href="javascript:void(0);" class="btn btn-success mr-2" (click)="runloanapplication()"><i class="feather-eye"></i> Run</a>
                  </div>
                  <div class="d-inline-block">
                    <a href="javascript:void(0);" class="btn btn-danger mr-2" (click)="close()"><i class="feather-x"></i> Cancel</a>
                  </div>
                </div>
                <div class="col-lg-12 col-xl-12 mb-3 mb-xl-0 mt-4">
                  <div class="row">
                    <div class="col-lg-12 ml-4" style="text-align:right;">
                      <!--<div class="d-inline-block" *ngIf='showEditBtns && showExportToExcelBtn'>
                        <a (click)="download('excel')" href="javascript:void(0);" class="btn btn-dark mr-2"><i class="fa fa-file-excel-o"></i> Export To Excel</a>
                      </div>-->


                    </div>
                  </div>
                </div>

              </div>

              <div *ngIf="hideShowFilterSection">
                <ul class="nav nav-tabs nav-cust" id="myTab" role="tablist">

                  <li class="nav-item">
                    <a class="nav-link active" id="selcolumn-tab" data-toggle="tab" href="#selcolumn" role="tab">Select Column</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="filter-tab" data-toggle="tab" href="#filter" role="tab">Filter</a>
                  </li>
                  <li class="nav-item">
                    <a *ngIf='islinkWithDashboard' class="nav-link" id="linkWithDashboard-tab" data-toggle="tab" href="#linkWithDashboard" role="tab">Link with Dashboard</a>
                  </li>
                </ul>


                <div class="tab-content" id="myTabContent">

                  <div class="tab-pane fade show active" id="selcolumn" role="tabpanel">
                    <div class="d-flex flex-wrap">
                      <div class="mover-panel-box col-md-5 p-0">
                        <div class="heading-border">
                          <h5 class="h5"><span>Available Fields</span></h5>
                        </div>
                        <div class="heading-border my-2">
                          <input class="form-control input-sm" type="text" [(ngModel)]='FieldlistFilter' name="FieldlistFilterN" placeholder="Search By Name" (keyup)='updateFieldlistFilter($event)'>
                        </div>

                        <div class="listing border-top">
                          <div class="table-responsive border">
                            <table id="example" class="table table-bordered" style="min-width:100px">
                              <thead class="thead-bg">
                                <tr role="row"><th scope="col" class="sorting_asc" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Field Name: activate to sort column ascending">Field Name</th></tr>
                              </thead>
                              <tbody>
                                <tr role="row" class="odd">
                                  <td class="p-0">
                                    <div [ngClass]="{'modal-bck':color.selected}" (click)='OnItemSelected(color)' *ngFor="let color of customFieldLeadListSecond" class="manageview-dragable">
                                      {{color.name}}
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                      <div class="mover-controls col-md-2">
                        <button type="button" (click)="OnShiftAllFromDragToDrop()">
                          <i aria-hidden="true"
                             class="fa fa-angle-double-down fa-2x d-md-none"></i><i aria-hidden="true" class="fa fa-angle-double-right fa-2x d-none d-md-block"></i>
                        </button>

                        <button type="button" (click)="OnShiftOneFromDragToDrop()"><i aria-hidden="true" class="feather-chevron-down fa-2x d-md-none"></i><i aria-hidden="true" class="feather-chevron-right fa-2x d-none d-md-block"></i></button>

                        <button type="button" (click)="OnShiftOneFromDropToDrag()"><i aria-hidden="true" class="feather-chevron-up fa-2x d-md-none"></i><i aria-hidden="true" class="feather-chevron-left fa-2x d-none d-md-block"></i></button>

                        <button (click)="OnShiftAllFromDropToDrag()" type="button"><i aria-hidden="true" class="fa fa-angle-double-up fa-2x d-md-none"></i><i aria-hidden="true" class="fa fa-angle-double-left fa-2x d-none d-md-block"></i></button>
                      </div>
                      <div class="mover-panel-box col-md-5 p-0">
                        <div class="heading-border">
                          <h5 class="h5"><span>Selected Fields</span></h5>
                        </div>
                        <div class="table-responsive border">
                          <table class="table table-bordered selected-fields" style="min-width:100px">
                            <thead>
                              <tr>
                                <th>
                                  Field Name
                                </th>
                                <th class="text-center">
                                  Sortable
                                </th>
                              </tr>
                            </thead>
                            <p-orderList #droppedView [value]="droped" dragdrop="true">

                              <ng-template let-c pTemplate="item">
                                <tr [ngClass]="{'modal-bck':c.selected}" (click)="onDroppedItemClick(c)">
                                  <td>
                                    <span>
                                      {{c.name}}
                                    </span>
                                  </td>
                                  <td class="text-center">
                                    <div class="custom-control custom-checkbox">
                                      <input type="checkbox" class="custom-control-input" [id]="c.form_field_id" (change)="c.isChecked = !c.isChecked" [checked]="c.isChecked">
                                      <label class="custom-control-label" [for]="c.form_field_id">&nbsp;</label>
                                    </div>

                                  </td>
                                </tr>
                              </ng-template>
                            </p-orderList>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="tab-pane fade" id="filter" role="tabpanel">
                    <form [formGroup]="reportForm" autocomplete="off">
                      <div class="table-responsive overflow-visible">
                        <table id="example" class="table ">
                          <thead class="thead-bg">
                            <tr>
                              <th scope="col" width="400">Field Name</th>
                              <th scope="col" width="250">Conditional Operator</th>
                              <th scope="col" width="250">Value</th>
                              <th scope="col"></th>
                              <th scope="col"></th>
                            </tr>
                          </thead>
                          <tbody formArrayName="fields">
                            <tr [formGroupName]="i" *ngFor="let field of fields.controls; let i=index">
                              <td>
                                <div class="form-group" style="width: 100%; padding: 0px;  margin: 0px; float: left; max-width:100%; min-width:250px;">
                                  <!--<ng-select [items]="customFieldList1" [closeOnSelect]="true" placeholder="Select field name" formControlName="filedNameId"
                                             (change)="onChangeField($event,field,i)"
                                             bindLabel="name" bindValue="value"
                                             [ngClass]="{'is-invalid': (field.controls.filedNameId.invalid && (field.controls.filedNameId.dirty || field.controls.filedNameId.touched) && field.controls.filedNameId.errors?.required) }">

                                  </ng-select>-->
                                  <!--<ng-select [items]="customFieldList1" placeholder="Sub Module Fields" bindLabel="name"
                                             formControlName="filedNameId" [(ngModel)]="subModuleFieldsSelectedValue"
                                             (clear)="resetSubModuleFieldIds()"
                                             (change)="onChangeField($event,field,i)"
                                             [ngClass]="{'is-invalid': (field.controls.filedNameId.invalid &&
                                                                      (field.controls.filedNameId.dirty || field.controls.filedNameId.touched)
                                                                    && field.controls.filedNameId.errors?.required) }">

                                  </ng-select>-->

                                  <ng-select [items]="customFieldList1" placeholder="Sub Module Fields"
                                             formControlName="filedNameId" [closeOnSelect]="true"
                                             (change)="onChangeField($event,field,i)"
                                             bindLabel="name" bindValue="form_field_id"
                                             [ngClass]="{'is-invalid': (field.controls.filedNameId.invalid &&
                                                                      (field.controls.filedNameId.dirty || field.controls.filedNameId.touched)
                                                                    && field.controls.filedNameId.errors?.required) }">
                                  </ng-select>


                                  <small *ngIf="field.controls.filedNameId.invalid && (field.controls.filedNameId.dirty || field.controls.filedNameId.touched) && field.controls.filedNameId.errors?.required"
                                         style="color:red;">Please select Field Name</small>
                                </div>
                              </td>
                              <td>
                                <div class="form-group" style="width: 100%;">
                                  <ng-select [items]="(field.get('operators')==null ? null : field.get('operators').value)" [closeOnSelect]="true" placeholder="Select operator"
                                             (click)="loadOperator(field.controls.filedNameId,field,i)" formControlName="operatorId" (change)="onChangeOperator($event,field,i)"
                                             bindLabel="text" bindValue="value" [ngClass]="{'is-invalid': (field.controls.operatorId.invalid && (field.controls.operatorId.dirty || field.controls.operatorId.touched) && field.controls.operatorId.errors?.required) }"></ng-select>
                                  <small *ngIf="field.controls.operatorId.invalid && (field.controls.operatorId.dirty || field.controls.operatorId.touched) && field.controls.operatorId.errors?.required"
                                         style="color:red;">Please select Operator</small>
                                </div>
                              </td>
                              <td>

                                <div class="form-group" *ngIf="field.get('dtCode') != null && !field.get('dtCode').value && field.get('fieldText').value!='datetime' && field.get('fieldText').value!='date' && field.get('fieldText').value!='boolean'" style="width: 100%;">
                                  <input type="text" class="form-control" formControlName="txtvaluefrom" maxlength="50"
                                         placeholder="Enter Value" (keyup)="onKey($event)"
                                         [ngClass]="{'is-invalid': (field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && (field.controls.txtvaluefrom.errors?.required || field.controls.txtvaluefrom.errors?.maxlength)) }">
                                  <small *ngIf="field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && field.controls.txtvaluefrom.errors?.required"
                                         class="text-danger">Value is required</small>
                                </div>
                                <div *ngIf="field.get('dtCode') != null && !field.get('dtCode').value && field.get('fieldText').value=='date'" style="width: 100%; padding: 0px; margin: 0px; float: left;">
                                  <p-calendar [showIcon]="true" class="calendarwidth" inputStyleClass="form-control start-date" formControlName="txtvaluefrom" hideOnDateTimeSelect="true"
                                              [showTime]="false" dateFormat="mm/dd/yy" showButtonBar="true" [monthNavigator]="true" [yearNavigator]="true" yearRange="1919:2030"></p-calendar>
                                  <small *ngIf="field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && field.controls.txtvaluefrom.errors?.required"
                                         class="text-danger">Value is required</small>
                                </div>
                                <div *ngIf="field.get('dtCode') != null && !field.get('dtCode').value && field.get('fieldText').value=='datetime'" style="width: 100%; padding: 0px;  margin: 0px; float: left;">
                                  <p-calendar [showIcon]="true" class="calendarwidth" inputStyleClass="form-control start-date " formControlName="txtvaluefrom" hideOnDateTimeSelect="true"
                                              [showTime]="true" inputId="timeonly" dateFormat="mm/dd/yy" showButtonBar="true" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2030" [hourFormat]="(timeFormat==24)?24:12"></p-calendar>
                                  <small *ngIf="field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && field.controls.txtvaluefrom.errors?.required"
                                         class="text-danger">Value is required</small>
                                </div>
                                <div class="form-group" *ngIf="field.get('dtCode') != null && field.get('dtCode').value" style="width: 100%; padding: 0px; margin: 0px; float: left;">

                                  <ng-select [items]="DdlValues[i]" [closeOnSelect]="true" placeholder="Select Value" formControlName="txtvaluefrom" [multiple]="true"
                                             bindLabel="name" bindValue="value" [ngClass]="{'is-invalid': (field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && field.controls.txtvaluefrom.errors?.required) }">

                                  </ng-select>

                                  <!--<ng-select [items]="DdlValues[i]" [closeOnSelect]="true" placeholder="Select Value" formControlName="txtvaluefrom"
                                             bindLabel="name" bindValue="value"
                                             (scrollToEnd)="onScrollToEnd(DdlValues[i])" [virtualScroll]="true"
                                             (clear)="onClearLang(DdlValues[i])"
                                             (keyup)="onKeyGetValue($event,serviceResourceNames)"
                                             [ngClass]="{'is-invalid': (field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && field.controls.txtvaluefrom.errors?.required) }"
                                             >

                                  </ng-select>-->

                                  <small *ngIf="field.controls.txtvaluefrom.invalid && (field.controls.txtvaluefrom.dirty || field.controls.txtvaluefrom.touched) && field.controls.txtvaluefrom.errors?.required"
                                         style="color:red;">Please select Field Name</small>
                                </div>

                                <div class="form-control pl-0 border-0 bg-transparent" *ngIf="field.get('dtCode') != null && field.get('fieldText').value=='boolean'">
                                  <div class="form-check form-check-inline">
                                    <div class="custom-control custom-checkbox pl-0">
                                      <label class="switch">
                                        <input type="checkbox" id="{{form_controlName}}" formControlName="txtvaluefrom">
                                        <span class="slider round" id="{{form_controlName}}"><span>Yes</span></span>
                                      </label>
                                    </div>
                                  </div>
                                </div>

                              </td>
                              <td>
                                <div class="form-group" *ngIf="field.controls.operatorId.value=='8' && field.get('fieldText').value!='datetime' && field.get('fieldText').value!='date' " style="width: 100%; padding: 0px;  margin: 0px; float: left;">
                                  <input type="text" class="form-control" formControlName="txtvalueto" maxlength="50" placeholder="Enter Value"
                                         [ngClass]="{'is-invalid': (field.controls.txtvalueto.invalid && (field.controls.txtvalueto.dirty || field.controls.txtvalueto.touched) && (field.controls.txtvalueto.errors?.required || field.controls.txtvalueto.errors?.maxlength)) }">
                                  <small *ngIf="field.controls.txtvalueto.invalid && (field.controls.txtvalueto.dirty || field.controls.txtvalueto.touched) && field.controls.txtvalueto.errors?.required"
                                         class="text-danger">Value is required</small>
                                </div>
                                <div *ngIf="field.controls.operatorId.value=='8' && field.get('fieldText').value=='datetime'" style="width: 100%; padding: 0px;  margin: 0px; float: left;">
                                  <p-calendar [showIcon]="true" class="calendarwidth" inputStyleClass="form-control start-date " formControlName="txtvalueto" hideOnDateTimeSelect="true"
                                              [showTime]="true" inputId="timeonly" dateFormat="mm/dd/yy" showButtonBar="true" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2030" [hourFormat]="(timeFormat==24)?24:12"></p-calendar>
                                  <small *ngIf="field.controls.txtvalueto.invalid && (field.controls.txtvalueto.dirty || field.controls.txtvalueto.touched) && field.controls.txtvalueto.errors?.required"
                                         class="text-danger">Value is required</small>
                                </div>
                                <div *ngIf="field.controls.operatorId.value=='8' && field.get('fieldText').value=='date'" style="width: 100%; padding: 0px;  margin: 0px; float: left;">
                                  <p-calendar [showIcon]="true" class="calendarwidth" inputStyleClass="form-control start-date" formControlName="txtvalueto" hideOnDateTimeSelect="true"
                                              [showTime]="false" dateFormat="mm/dd/yy" showButtonBar="true" [monthNavigator]="true" [yearNavigator]="true" yearRange="1919:2030"></p-calendar>
                                  <small *ngIf="field.controls.txtvalueto.invalid && (field.controls.txtvalueto.dirty || field.controls.txtvalueto.touched) && field.controls.txtvalueto.errors?.required"
                                         class="text-danger">Value is required</small>
                                </div>
                              </td>
                              <td style="min-width:100px;">
                                <div *ngIf="field.controls.type.value!=null && field.controls.type.value!=''" class="d-inline-block mr-2">
                                  <span class="or-and rounded-circle">{{field.controls.type.value}}</span>
                                </div>
                                <div class="form-group mt-2 mb-0 d-inline-block float-right">
                                  <a *ngIf="i > 0" href="javascript:void(0);" (click)="removeFields(i)"><i class="feather-trash-2 text-danger" style="font-size:18px;"></i></a>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="col-lg-12 px-0 text-center mt-2 mb-4 bg-light py-2">
                        <!--<a href="javascript:void(0);" class="btn btn-success" (click)="addFields()"><i class="feather-plus pr-2"></i>Add</a>-->
                        <ng-select [items]="ddlData" placeholder="Add" #condition
                                   bindLabel="name" bindValue="id" (change)="addFields($event.name)" style="max-width:120px;display:inline-block;"></ng-select>
                      </div>
                    </form>
                  </div>
                  <div class="tab-pane fade" id="linkWithDashboard" role="tabpanel" *ngIf='islinkWithDashboard'>
                    <div class="d-flex flex-wrap">
                      <div class="col-md-4 border-right">
                        <div class="">
                          <label><b>Link as a Count Widget with Dashboard:</b></label>
                          <div class="form-group">
                            <label class="switch">
                              <input type="checkbox" [(ngModel)]="isCountWidget" (change)='onCountWidget($event)'>
                              <span class="slider round"><span>Yes</span></span>
                            </label>
                          </div>

                          <form [formGroup]="addCountWidgetForm">
                            <div class="form-group" *ngIf='showApplyToFields'>
                              <label>Apply To: <span class="text-danger">*</span></label>
                              <div class="form-group">
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                  <input formControlName="radiogroup" type="radio" id="test1" name="radiogroup" value="Only For Me" (change)="OnChangeApplyToValue($event)">
                                  <label class="custom-control-label" for="test1">Only For Me</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="!companyadmin">
                                  <input formControlName="radiogroup" type="radio" id="test4" name="radiogroup" value="Only For Me" (change)="OnChangeApplyToValue($event)">
                                  <label class="custom-control-label" for="test4">Only For Me</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                  <input type="radio" value="Roles" formControlName="radiogroup" id="test2" name="radiogroup" (change)="OnChangeApplyToValue($event)">
                                  <label class="custom-control-label" for="test2">Roles</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                  <input type="radio" id="test3" name="radiogroup" value="All" formControlName="radiogroup" (change)="OnChangeApplyToValue($event)">
                                  <label class="custom-control-label" for="test3">All</label>
                                </div>
                              </div>
                              <div class="right pt-2">
                                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#exampleModal">
                                  <i class="feather-flag mr-1"></i>
                                  Choose Icon
                                </button>
                              </div>
                            </div>
                            <div class="w-100" *ngIf="addCountWidgetForm.value.radiogroup == 'Roles' && showApplyToFields">
                              <div class="" *ngIf="companyadmin">
                                <div class="form-group">
                                  <label>Roles: <span class="text-danger">*</span></label>
                                  <ng-select [items]="RoleList" [loading]="loadSave" placeholder="Select Roles" formControlName="selectedRole" multiple="true"
                                             bindLabel="text" bindValue="value"
                                             [ngClass]="{'is-invalid': (addCountWidgetForm.get('selectedRole')?.errors?.required && addCountWidgetForm.get('selectedRole')?.invalid
                                  && (addCountWidgetForm.get('selectedRole')?.dirty || addCountWidgetForm.get('selectedRole')?.touched))}">
                                  </ng-select>
                                  <small *ngIf="(addCountWidgetForm.get('selectedRole')?.errors?.required && addCountWidgetForm.get('selectedRole')?.invalid
                                  && (addCountWidgetForm.get('selectedRole')?.dirty || addCountWidgetForm.get('selectedRole')?.touched))" class="text-danger">Role is required</small>
                                </div>
                              </div>
                            </div>
                            <app-common-icon-picker (iconSelector)="iconClassReceiver($event)" ></app-common-icon-picker>
                          </form>

                          <div *ngIf='showApplyToFields'>
                            <span><strong>Total Records:</strong> {{totalRecords}}</span>
                          </div>
                        </div>
                 
                      </div>
                      <div class="col-md-4 border-right">
                        <div class="">
                          <label><b>Link as a Chart View with Dashboard:</b></label>
                          <div class="form-group">
                            <label class="switch">
                              <input type="checkbox" [(ngModel)]='isChartView' (change)='onChatView($event)'>
                              <span class="slider round"><span>Yes</span></span>
                            </label>
                          </div>

                          <div>
                            <form [formGroup]="addBarChartForm">
                              <div class="form-group" *ngIf='displayCharts'>
                                <label>Apply To: <span class="text-danger">*</span></label>
                                <div class="form-group">
                                  <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                    <input formControlName="radioChartBtn" type="radio" id="test144" name="radioChartBtn" value="Only For Me" (change)="OnChangeChartApplyToValue($event)">
                                    <label class="custom-control-label" for="test144">Only For Me</label>
                                  </div>
                                  <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="!companyadmin">
                                    <input formControlName="radioChartBtn" type="radio" id="test433" name="radioChartBtn" value="Only For Me" (change)="OnChangeChartApplyToValue($event)">
                                    <label class="custom-control-label" for="test433">Only For Me</label>
                                  </div>
                                  <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                    <input type="radio" value="Roles" formControlName="radioChartBtn" id="test267" name="radioChartBtn" (change)="OnChangeChartApplyToValue($event)">
                                    <label class="custom-control-label" for="test267">Roles</label>
                                  </div>
                                  <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                    <input type="radio" id="test355" name="radioChartBtn" value="All" formControlName="radioChartBtn" (change)="OnChangeChartApplyToValue($event)">
                                    <label class="custom-control-label" for="test355">All</label>
                                  </div>
                                </div>
                              </div>
                              <div class="w-100" *ngIf="addBarChartForm.value.radioChartBtn == 'Roles' && displayCharts">
                                <div class="" *ngIf="companyadmin">
                                  <div class="form-group">
                                    <label>Roles: <span class="text-danger">*</span></label>
                                    <ng-select [items]="RoleList" [loading]="loadSave" placeholder="Select Roles" formControlName="chartSelectedRole" multiple="true"
                                               bindLabel="text" bindValue="value"
                                               [ngClass]="{'is-invalid': (addBarChartForm.get('chartSelectedRole')?.errors?.required && addBarChartForm.get('chartSelectedRole')?.invalid
                  && (addBarChartForm.get('chartSelectedRole')?.dirty || addBarChartForm.get('chartSelectedRole')?.touched))}">
                                    </ng-select>
                                    <small *ngIf="(addBarChartForm.get('chartSelectedRole')?.errors?.required && addBarChartForm.get('chartSelectedRole')?.invalid
                     && (addBarChartForm.get('chartSelectedRole')?.dirty || addBarChartForm.get('chartSelectedRole')?.touched))" class="text-danger">Role is required</small>
                                  </div>
                                </div>
                              </div>
                            </form>

                          </div>

                          <div class="form-group" *ngIf='displayCharts'>
                            <label> <b>Display As:</b> </label>
                            <div>
                              <div class="form-group">
                                <div class="custom-control-inline custom-icon-radio" *ngIf="companyadmin" (click)='onClickHorizontalChart()'>
                                  <input type="radio" id="chart" name="radiogroup" [checked]="isHorizontalChart">
                                  <label class="custom-control-label" for="chart"><i class="feather-chevron-left" aria-hidden="true" tooltip="Line Chart"></i></label>
                                </div>
                                <div class="custom-control-inline custom-icon-radio" *ngIf="companyadmin" (click)='onClickPieChart()'>
                                  <input type="radio" id="piechart" name="radiogroup" value="chart" [checked]="isPieChart">
                                  <label class="custom-control-label" for="piechart"><i class="fa fa-pie-chart" aria-hidden="true" tooltip="Pie Chart"></i></label>
                                </div>
                                <!--<div class="custom-control-inline custom-icon-radio" *ngIf="companyadmin">
                                  <input type="radio" id="linechart" name="radiogroup" value="chart">
                                  <label class="custom-control-label" for="linechart"><i class="fa fa-line-chart" aria-hidden="true"></i></label>
                                </div>-->
                                <div class="custom-control-inline custom-icon-radio" *ngIf="companyadmin" (click)='onClickAreaChart()'>
                                  <input type="radio" id="areachart" name="radiogroup" value="chart" [checked]="isAreaChart">
                                  <label class="custom-control-label" for="areachart"><i class="fa fa-area-chart" aria-hidden="true" tooltip="Column Chart"></i></label>
                                </div>
                              </div>

                              <div *ngIf='showBarChartFields'>
                                <!--<label> <b>Chart</b> </label>-->
                                <form [formGroup]="addBarChartForm">
                                  <div class="form-group">
                                    <label>Y-Axis:<span class="text-danger">*</span></label>
                                    <ng-select [items]="yAxisList" placeholder="Select Y-Axis" formControlName="yAxisId"
                                               bindLabel="name" bindValue="form_field_id"
                                               [ngClass]="{'is-invalid': (yAxisId.invalid && (yAxisId.dirty || yAxisId.touched) && yAxisId.errors?.required) }"></ng-select>
                                    <small *ngIf="yAxisId.touched && yAxisId.errors?.required" class="text-danger">Please select Y-Axis</small>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="">
                          <label><b>Link as a List View with Dashboard:</b></label>
                          <div class="form-group">
                            <label class="switch">
                              <input type="checkbox" [(ngModel)]='isListView' (change)='onListView($event)'>
                              <span class="slider round"><span>Yes</span></span>
                            </label>
                          </div>

                          <form [formGroup]="addListViewForm">
                            <div class="form-group" *ngIf='showListViewApplyToFields'>
                              <label>Apply To: <span class="text-danger">*</span></label>
                              <div class="form-group">
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                  <input formControlName="listViewRadioBtn" type="radio" id="test11" name="listViewRadioBtn" value="Only For Me" (change)="OnChangeListViewApplyToValue($event)">
                                  <label class="custom-control-label" for="test11">Only For Me</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="!companyadmin">
                                  <input formControlName="listViewRadioBtn" type="radio" id="test44" name="listViewRadioBtn" value="Only For Me" (change)="OnChangeListViewApplyToValue($event)">
                                  <label class="custom-control-label" for="test44">Only For Me</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                  <input type="radio" value="Roles" formControlName="listViewRadioBtn" id="test22" name="listViewRadioBtn" (change)="OnChangeListViewApplyToValue($event)">
                                  <label class="custom-control-label" for="test22">Roles</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline pl-0" *ngIf="companyadmin">
                                  <input type="radio" id="test33" name="listViewRadioBtn" value="All" formControlName="listViewRadioBtn" (change)="OnChangeListViewApplyToValue($event)">
                                  <label class="custom-control-label" for="test33">All</label>
                                </div>
                              </div>
                            </div>
                            <div class="w-100" *ngIf="addListViewForm.value.listViewRadioBtn == 'Roles' && showListViewApplyToFields">
                              <div class="" *ngIf="companyadmin">
                                <div class="form-group">
                                  <label>Roles: <span class="text-danger">*</span></label>
                                  <ng-select [items]="RoleList" [loading]="loadSave" placeholder="Select Roles" formControlName="listViewselectedRole" multiple="true"
                                             bindLabel="text" bindValue="value"
                                             [ngClass]="{'is-invalid': (addListViewForm.get('listViewselectedRole')?.errors?.required && addListViewForm.get('listViewselectedRole')?.invalid
                  && (addListViewForm.get('listViewselectedRole')?.dirty || addListViewForm.get('listViewselectedRole')?.touched))}">
                                  </ng-select>
                                  <small *ngIf="(addListViewForm.get('listViewselectedRole')?.errors?.required && addListViewForm.get('listViewselectedRole')?.invalid
                     && (addListViewForm.get('listViewselectedRole')?.dirty || addListViewForm.get('listViewselectedRole')?.touched))" class="text-danger">Role is required</small>
                                </div>
                              </div>
                            </div>

                            <div class="form-group" *ngIf='showListViewApplyToFields'>
                              <label>Select Fields (You can select maximum 5 columns):<span class="text-danger">*</span></label>
                              <ng-select [items]="yAxisList" placeholder="Select Y-Axis" formControlName="listViewFields"
                                         bindLabel="name" bindValue="form_field_id" [multiple]="true" [maxSelectedItems]="5"
                                         [ngClass]="{'is-invalid': (listViewFields.invalid && (listViewFields.dirty || listViewFields.touched) && listViewFields.errors?.required) }"></ng-select>
                              <small *ngIf="listViewFields.touched && listViewFields.errors?.required" class="text-danger">Please select Fields</small>
                              <small *ngIf="[maxSelectedItems]=='5'" class="text-danger">You can select only 5 records.</small>
                            </div>

                          </form>

                          <!--<div class="mover-panel-box col-md-10 p-0">
                            <div class="heading-border">
                              <h5 class="h5"><span>Select Fields</span></h5>
                            </div>
                            <div class="table-responsive border">
                              <table class="table table-bordered selected-fields" style="min-width:100px">
                                <p-orderList #selectListView [value]="selectedListViewItems" dragdrop="true">

                                  <ng-template let-c pTemplate="item">
                                    <tr [ngClass]="{'modal-bck':c.selected}" (click)="onSelectItemClick(c)">
                                      <td>
                                        <span>
                                          {{c.name}}
                                        </span>
                                      </td>
                                    </tr>
                                  </ng-template>
                                </p-orderList>
                              </table>
                            </div>
                          </div>-->


                        </div>
                      </div>
                    </div>
                  </div>




                </div>
              </div>
            </div>
            

          </div>
          

        </div>
      </div>
      <div class="panel-content px-3 pagination2 table-responsive no-padding" *ngIf="columnheading!=null && columnheading!='' && columnheading.length!=0 && showreportData">
        <div class="table-responsive">
          <div class="table table-striped">


            <ngx-datatable #table class="bootstrap table table-hover table-dynamic"
                           [rows]="columndata"
                           [columnMode]="'force'"
                           [headerHeight]="40"
                           [footerHeight]="40"
                           [scrollbarH]="true"
                           [rowHeight]="'40'"
                           [externalPaging]="true"
                           [rowClass]="ApplyCssClassOnRow"
                           [externalSorting]="true"
                           [loadingIndicator]="isloadSave"
                           [count]="totalRecords"
                           [offset]="currentPage"
                           [limit]="pageSizeValue"
                           (page)='setPage($event)'
                           (sort)="onSort($event)">

              <ngx-datatable-column *ngFor="let col of columnheading" [name]="col.DISPLAY_NAME" [prop]="col.COLUMN_NAME" [sortable]="true">
                <ng-template let-row="row" ngx-datatable-cell-template>
                  <div class="doc-count">

                    <div [title]="row[col.COLUMN_NAME]" *ngIf="col.DATA_TYPE!='date' && col.isColor !=true">
                      {{row[col.COLUMN_NAME]}}
                    </div>

                    <div *ngIf="col.FieldFrom==null && col.isColor ==true">
                      <div *ngFor="let itemColorCode of getListingColorCode(row[col.COLUMN_NAME]);">
                        <div *ngIf="itemColorCode.colorkey==undefined">
                          {{itemColorCode.color}}
                        </div>
                        <div *ngIf="itemColorCode.colorkey!=undefined" style="max-width:150px !important;" class="status-box" [title]="itemColorCode.color" [ngStyle]="{background: itemColorCode.colorkey}">
                          {{itemColorCode.color}}
                        </div>
                      </div>
                    </div>

                    <div [title]="row[col.COLUMN_NAME]" *ngIf="col.DATA_TYPE=='date'">
                      {{ (row[col.COLUMN_NAME] !== null) ? (row[col.COLUMN_NAME]  | date: 'MM-dd-yyyy' ) : "" }}
                    </div>

                  </div>

                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-footer>
                <ng-template ngx-datatable-footer-template
                             let-rowCount="rowCount"
                             let-pageSize="pageSize"
                             let-selectedCount="selectedCount"
                             let-currentPage="curPage"
                             let-offset="offset"
                             let-isVisible="isVisible">
                  <div>
                    <div style="color:black; margin-right:10px;" class="page-size-record" *ngIf='(rowCount  > 0)'>
                      <span style="text-align:right; width:80px;vertical-align: middle;">
                        <ng-select [searchable]="false" [items]="lstPageSize" appendTo="body" [(ngModel)]='pageSizeValue' dropzone="fixed" [clearable]="false" (change)="onChange($event)" draggable="false" [closeOnSelect]="true"
                                   bindLabel="text" bindValue="text"></ng-select>
                      </span>
                    </div>
                  </div>
                  <div class="page-count" *ngIf='(rowCount  > 0)'>
                    <!--Showing {{(curPage - 1 )* pageSizeValue + 1}}  to {{curPage * pageSizeValue}} out of {{totalRecords}}  enteries-->
                    {{commonService.PageString(curPage,pageSizeValue,rowCount)}}
                  </div>
                  <datatable-pager [pagerLeftArrowIcon]="'feather-chevron-left'"
                                   [pagerRightArrowIcon]="'feather-chevron-right'"
                                   [pagerPreviousIcon]="'feather-chevrons-left'"
                                   [pagerNextIcon]="'feather-chevrons-right'"
                                   [page]="curPage"
                                   [size]="pageSizeValue"
                                   [count]="totalRecords"
                                   [hidden]="!((rowCount / pageSize) > 1)"
                                   (change)="setPage($event)"
                                   [ngClass]="{'text-lg-right':true,'text-md-right':true}">
                  </datatable-pager>
                </ng-template>
              </ngx-datatable-footer>
            </ngx-datatable>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

